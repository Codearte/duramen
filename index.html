<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Duramen by Codearte</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Duramen</h1>
        <h2>Java Persistent Event Bus</h2>
        <a href="https://github.com/Codearte/duramen" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="duramen" class="anchor" href="#duramen"><span class="octicon octicon-link"></span></a>Duramen</h1>

<p>Persistent event bus implementation for Java. Easily integrates with Spring Framework. By default uses file backed database. Guarantees that event will be dispatched.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage:</h2>

<ol>
<li>Add duramen dependency:
eu.codearte.duramen:duramen:0.9.0</li>
<li>
<p>Use <code>@EnableDuramen</code> annotation to import Duramen into your project:</p>

<div class="highlight highlight-java"><pre>  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableDuramen</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooConfiguration</span> <span class="o">{</span>

  <span class="o">}</span>
</pre></div>
</li>
<li>
<p>Implement custom event class:</p>

<div class="highlight highlight-java"><pre>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooEvent</span> <span class="kd">extends</span> <span class="n">Event</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>

      <span class="c1">// getters and setters</span>
  <span class="o">}</span>
</pre></div>
</li>
<li>
<p>To produce events you have to implement producer component:</p>

<div class="highlight highlight-java"><pre>  <span class="kn">import</span> <span class="nn">eu.codearte.duramen.EventBus</span><span class="o">;</span>

  <span class="nd">@Component</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooEventProducer</span> <span class="o">{</span>

      <span class="kd">private</span> <span class="kd">final</span> <span class="n">EventBus</span> <span class="n">eventBus</span><span class="o">;</span>

      <span class="nd">@Autowired</span>
      <span class="kd">public</span> <span class="nf">FooEventProducer</span><span class="o">(</span><span class="n">EventBus</span> <span class="n">eventBus</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">eventBus</span> <span class="o">=</span> <span class="n">eventBus</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="cm">/** </span>
<span class="cm">       * This method will be called from your production code</span>
<span class="cm">      */</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">produce</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">FooEvent</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FooEvent</span><span class="o">();</span>
          <span class="n">event</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"Test message"</span><span class="o">);</span>
          <span class="n">eventBus</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</pre></div>
</li>
<li>
<p>To receive events you have to implement consumer. Generic type in <code>EventHandler</code> will decide which events will be processed in particular consumer:</p>

<div class="highlight highlight-java"><pre>  <span class="kn">import</span> <span class="nn">eu.codearte.duramen.handler.EventHandler</span><span class="o">;</span>

  <span class="nd">@Component</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooEventConsumer</span> <span class="kd">implements</span> <span class="n">EventHandler</span><span class="o">&lt;</span><span class="n">FooEvent</span><span class="o">&gt;</span> <span class="o">{</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEvent</span><span class="o">(</span><span class="n">FooEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Received message: "</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
      <span class="o">}</span>

  <span class="o">}</span>
</pre></div>
</li>
</ol><h2>
<a name="testing" class="anchor" href="#testing"><span class="octicon octicon-link"></span></a>Testing:</h2>

<p>Usually in test scope we don't want to persist our events. To achieve such behaviour we can configure custom bean:</p>

<div class="highlight highlight-java"><pre>    <span class="kn">import</span> <span class="nn">eu.codearte.duramen.datastore.InMemory</span><span class="o">();</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Datastore</span> <span class="nf">inMemoryDatastore</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">InMemory</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>

<h2>
<a name="error-handling" class="anchor" href="#error-handling"><span class="octicon octicon-link"></span></a>Error handling:</h2>

<p>When <code>EventHandler</code> processing bean throws an exception, it will be logged with event data serialized to JSON.</p>

<p>You can specify custom <code>ExceptionHandler</code> by creating bean implementing <code>eu.codearte.duramen.handler.ExceptionHandler</code> interface.</p>

<h2>
<a name="available-datastores" class="anchor" href="#available-datastores"><span class="octicon octicon-link"></span></a>Available datastores</h2>

<p>In Duramen there are 3 <code>Datastore</code> objects.</p>

<h3>
<a name="filedata" class="anchor" href="#filedata"><span class="octicon octicon-link"></span></a>FileData</h3>

<p>Default implementation. Backed by <a href="https://github.com/OpenHFT/HugeCollections">HugeCollections</a> SharedHashMap. It stores events in binary file (by default duramen.data).
To use this implementation you don't have to do anything, as long as you accept default values (see "Specifying messages limits").
To change defaults you need create own bean:</p>

<div class="highlight highlight-java"><pre>    <span class="kn">import</span> <span class="nn">eu.codearte.duramen.datastore.FileData</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Datastore</span> <span class="nf">fileDatastore</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">FileData</span><span class="o">(</span><span class="s">"/tmp/myfile.data"</span><span class="o">,</span> <span class="cm">/*entries*/</span> <span class="mi">10</span><span class="o">,</span> <span class="cm">/*entrySize*/</span><span class="o">,</span> <span class="mi">8192</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="embedded-h2" class="anchor" href="#embedded-h2"><span class="octicon octicon-link"></span></a>Embedded H2</h3>

<p>You can also use embedded H2 database.</p>

<div class="highlight highlight-java"><pre>    <span class="kn">import</span> <span class="nn">eu.codearte.duramen.datastore.EmbeddedH2</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Datastore</span> <span class="nf">embeddedH2Datastore</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">EmbeddedH2</span><span class="o">();</span>
    <span class="o">}</span>

 <span class="c1">// or</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Datastore</span> <span class="nf">embeddedH2Datastore</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">EmbeddedH2</span><span class="o">(</span><span class="s">"jdbc:h2:file:/tmp/duramen.data"</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="relational-db" class="anchor" href="#relational-db"><span class="octicon octicon-link"></span></a>Relational DB</h3>

<p>If you want to use your own relational database as a <code>Datastore</code> it is of course possible. 
You just need to create class extending <code>eu.codearte.duramen.datastore.RelationalDB</code></p>

<h3>
<a name="in-memory" class="anchor" href="#in-memory"><span class="octicon octicon-link"></span></a>In memory</h3>

<p>We've already described <code>InMemory</code> datastore in "Testing" section</p>

<h2>
<a name="customizing-default-configuration" class="anchor" href="#customizing-default-configuration"><span class="octicon octicon-link"></span></a>Customizing default configuration:</h2>

<p>As you can see to use Duramen no configuration is required. However if you want, there are some options to customize.</p>

<h3>
<a name="specifying-messages-limits" class="anchor" href="#specifying-messages-limits"><span class="octicon octicon-link"></span></a>Specifying messages limits:</h3>

<p>By default message size is set to 4096 bytes. You can change this value by defining bean:</p>

<div class="highlight highlight-java"><pre>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">maxMessageSize</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">8192</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<p>Message count limit is set to 1024 events in queue. You can change this value by defining bean:</p>

<div class="highlight highlight-java"><pre>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">maxMessageCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">2048</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="processing-options" class="anchor" href="#processing-options"><span class="octicon octicon-link"></span></a>Processing options</h3>

<p>By default Duramen uses daemon threads, but it can be easily changes by declaring:</p>

<div class="highlight highlight-java"><pre>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">useDaemonThreads</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<p>Also number of threads processing events (default we use only one thread) can be increased:</p>

<div class="highlight highlight-java"><pre>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">maxProcessingThreads</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<p>Finally, if you want, there is a possibility to use own ExecutorService for processing events.</p>

<div class="highlight highlight-java"><pre>    <span class="nd">@Bean</span>
        <span class="kd">public</span> <span class="n">ExecutorService</span> <span class="nf">duramenExecutorService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Codearte/duramen/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Codearte/duramen/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Codearte/duramen"></a> is maintained by <a href="https://github.com/Codearte">Codearte</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>